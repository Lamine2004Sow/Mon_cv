{% comment %}
  Composant pour intégrer des démos interactives dans les pages
  
  Paramètres:
  - type: type de démo (threejs, matplotlib, gymnasium, 2d, 3d, plotly, etc.)
  - src: chemin vers le fichier de démo (HTML, JS, ou Python)
  - width: largeur (défaut: 100%)
  - height: hauteur (défaut: 400px)
  - title: titre de la démo (optionnel)
  - description: description de la démo (optionnel)
  - interactive: si la démo est interactive (défaut: true)
  - code: code source à afficher (optionnel)
{% endcomment %}

<div class="demo-container" data-demo-type="{{ include.type }}" data-interactive="{{ include.interactive | default: true }}">
  {% if include.title %}
  <div class="demo-header">
    <h4 class="demo-title">{{ include.title }}</h4>
    {% if include.description %}
    <p class="demo-description">{{ include.description }}</p>
    {% endif %}
  </div>
  {% endif %}
  
  <div class="demo-wrapper" style="width: {{ include.width | default: '100%' }}; height: {{ include.height | default: '400px' }};">
    {% case include.type %}
      {% when 'threejs' %}
        <div id="demo-{{ include.id | default: 'threejs' }}" class="demo-threejs">
          <p class="demo-placeholder" id="placeholder-{{ include.id | default: 'threejs' }}">Chargement de la visualisation 3D...</p>
        </div>
        {% if include.src %}
        <script type="module">
          import('{{ include.src }}').catch(error => {
            console.error('Erreur lors du chargement de la démo Three.js:', error);
            const placeholder = document.getElementById('placeholder-{{ include.id | default: 'threejs' }}');
            if (placeholder) {
              placeholder.textContent = 'Démo Three.js - Fichier non trouvé. Vérifiez le chemin: {{ include.src }}';
              placeholder.style.color = '#d08a4b';
            }
          });
        </script>
        <script type="module" src="{{ include.src }}"></script>
        {% endif %}
        
      {% when 'matplotlib' %}
        <div id="demo-{{ include.id | default: 'matplotlib' }}" class="demo-matplotlib">
          {% if include.src %}
          <img src="{{ include.src }}" alt="{{ include.title | default: 'Matplotlib visualization' }}" style="max-width: 100%; height: auto;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <p class="demo-placeholder" style="display: none;">Image Matplotlib non disponible. Placez votre image dans <code>{{ include.src }}</code></p>
          {% else %}
          <p class="demo-placeholder">Démo Matplotlib - Image à charger</p>
          {% endif %}
        </div>
        
      {% when 'gymnasium' %}
        <div id="demo-{{ include.id | default: 'gymnasium' }}" class="demo-gymnasium">
          <canvas id="canvas-{{ include.id | default: 'gymnasium' }}"></canvas>
          <div class="demo-controls">
            <button class="demo-btn" onclick="startGymnasiumDemo('{{ include.id | default: 'gymnasium' }}')">Démarrer</button>
            <button class="demo-btn" onclick="stopGymnasiumDemo('{{ include.id | default: 'gymnasium' }}')">Arrêter</button>
            <button class="demo-btn" onclick="resetGymnasiumDemo('{{ include.id | default: 'gymnasium' }}')">Réinitialiser</button>
          </div>
        </div>
        {% if include.src %}
        <script src="{{ include.src }}"></script>
        {% endif %}
        
      {% when 'plotly' %}
        <div id="demo-{{ include.id | default: 'plotly' }}" class="demo-plotly"></div>
        {% if include.src %}
        <script>
          fetch('{{ include.src }}')
            .then(response => response.json())
            .then(data => {
              Plotly.newPlot('demo-{{ include.id | default: 'plotly' }}', data.data, data.layout);
            })
            .catch(error => {
              console.error('Erreur lors du chargement du graphique Plotly:', error);
              document.getElementById('demo-{{ include.id | default: 'plotly' }}').innerHTML = 
                '<p style="padding: 2rem; text-align: center; color: #6b7280;">Graphique Plotly - Fichier de données non trouvé</p>';
            });
        </script>
        {% endif %}
        
      {% when '2d' %}
        <div id="demo-{{ include.id | default: '2d' }}" class="demo-2d">
          <canvas id="canvas-{{ include.id | default: '2d' }}"></canvas>
          <p class="demo-placeholder" id="placeholder-2d-{{ include.id | default: '2d' }}" style="display: none;">Chargement de l'animation 2D...</p>
        </div>
        {% if include.src %}
        <script>
          const script = document.createElement('script');
          script.src = '{{ include.src }}';
          script.onerror = function() {
            const placeholder = document.getElementById('placeholder-2d-{{ include.id | default: '2d' }}');
            if (placeholder) {
              placeholder.style.display = 'block';
              placeholder.textContent = 'Démo 2D - Fichier non trouvé. Vérifiez le chemin: {{ include.src }}';
              placeholder.style.color = '#d08a4b';
            }
          };
          document.head.appendChild(script);
        </script>
        {% endif %}
        
      {% when '3d' %}
        <div id="demo-{{ include.id | default: '3d' }}" class="demo-3d">
          <canvas id="canvas-{{ include.id | default: '3d' }}"></canvas>
        </div>
        {% if include.src %}
        <script type="module" src="{{ include.src }}"></script>
        {% endif %}
        
      {% when 'iframe' %}
        <iframe 
          src="{{ include.src }}" 
          class="demo-iframe"
          width="{{ include.width | default: '100%' }}" 
          height="{{ include.height | default: '400px' }}"
          frameborder="0"
          allowfullscreen>
        </iframe>
        
      {% when 'custom' %}
        <div id="demo-{{ include.id | default: 'custom' }}" class="demo-custom">
          {% if include.src %}
          <script src="{{ include.src }}"></script>
          {% endif %}
        </div>
        
      {% else %}
        <div class="demo-placeholder">
          <p>Type de démo non reconnu: {{ include.type }}</p>
          <p>Types supportés: threejs, matplotlib, gymnasium, plotly, 2d, 3d, iframe, custom</p>
        </div>
    {% endcase %}
  </div>
  
  {% if include.code %}
  <details class="demo-code-section">
    <summary class="demo-code-toggle">Voir le code source</summary>
    <pre><code>{{ include.code | escape }}</code></pre>
  </details>
  {% endif %}
</div>

<style>
  .demo-container {
    margin: 2rem 0;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    background: white;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }
  
  .demo-header {
    padding: 1rem 1.5rem;
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
  }
  
  .demo-title {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    color: var(--text-primary);
  }
  
  .demo-description {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
  }
  
  .demo-wrapper {
    padding: 1rem;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 200px;
  }
  
  .demo-threejs,
  .demo-3d {
    width: 100%;
    height: 100%;
    position: relative;
  }
  
  .demo-threejs canvas,
  .demo-3d canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  
  .demo-gymnasium {
    width: 100%;
    height: 100%;
    position: relative;
  }
  
  .demo-gymnasium canvas {
    width: 100%;
    height: calc(100% - 50px);
    display: block;
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
  }
  
  .demo-controls {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem 0;
    justify-content: center;
  }
  
  .demo-btn {
    padding: 0.5rem 1rem;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    transition: var(--transition);
  }
  
  .demo-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
  }
  
  .demo-2d canvas {
    width: 100%;
    height: auto;
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    display: block;
  }
  
  .demo-matplotlib {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .demo-plotly {
    width: 100%;
    height: 100%;
  }
  
  .demo-iframe {
    border: none;
    border-radius: 0.25rem;
    display: block;
  }
  
  .demo-placeholder {
    padding: 2rem;
    text-align: center;
    color: var(--text-secondary);
    font-style: italic;
  }
  
  .demo-code-section {
    border-top: 1px solid var(--border-color);
    background: var(--bg-secondary);
  }
  
  .demo-code-toggle {
    padding: 0.75rem 1.5rem;
    cursor: pointer;
    font-weight: 500;
    color: var(--primary-color);
    user-select: none;
    transition: var(--transition);
  }
  
  .demo-code-toggle:hover {
    background: var(--bg-primary);
  }
  
  .demo-code-section pre {
    margin: 0;
    border-radius: 0;
    border-top: 1px solid var(--border-color);
  }
  
  @media (max-width: 768px) {
    .demo-wrapper {
      padding: 0.5rem;
    }
    
    .demo-controls {
      flex-wrap: wrap;
    }
    
    .demo-btn {
      flex: 1;
      min-width: 100px;
    }
  }
</style>

<script>
  // Fonctions utilitaires pour les démos Gymnasium
  function startGymnasiumDemo(id) {
    console.log('Démarrage de la démo Gymnasium:', id);
    // À implémenter selon votre démo spécifique
  }
  
  function stopGymnasiumDemo(id) {
    console.log('Arrêt de la démo Gymnasium:', id);
    // À implémenter selon votre démo spécifique
  }
  
  function resetGymnasiumDemo(id) {
    console.log('Réinitialisation de la démo Gymnasium:', id);
    // À implémenter selon votre démo spécifique
  }
</script>
